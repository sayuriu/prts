<div id="container" class="h-auto fw">
	<div id="combat-skills" class="fw rel even z0">
        <div
            class="section-title abs t0 z-1 anim-AbsSnapToTop"
            [attr.no-anim]="animAlreadyPlayed"
        >COMBAT</div>
        <div id="skill-list" class="flex flex-col">
            <!--* Start custom component layout-->
            <!--* Name: InputField -->
            <!--* Defs: inherits TextField, implements InputField, extendable TextInput, RangeInput -->
            <div
                id="skilllevel-control"
                class="flex flex-row a-flex-center a-self-center z5"
                style="position: fixed; top: 215px"
            >
                <div id="label">
                    <p>SKILL_LEVEL</p>
                </div>
                <div>
                    <input
                        class="pointer-all cur-resize-ns"
                        #input
                        type="range"
                        min="0"
                        [attr.max]="(currentOperatorSkills[currentSkillIndex]?.levels ?? []).length - 1"
                        [attr.value]="currentCombatSkillLevel.value"
                        (input)="handleSkillLevelChange(input)"
                        (wheel)="handleSkillLevelChange(input, $event)"
                    >
                </div>
                <div id="level" class="grid fh">
                    <div class="fw fh" style="background-image: url(/assets/gamedata/img/characters/ui/skillrank/bg.png)"></div>
                    <div class="fw fh" [style.background-image]="'url(/assets/gamedata/img/characters/ui/skillrank/' + (parseNumber(currentCombatSkillLevel.value) < 7 ? add1(parseNumber(currentCombatSkillLevel.value)) : ('m-' + (parseNumber(currentCombatSkillLevel.value) - 6))) + '.png)'"></div>
                </div>
            </div>
            <!--* End custom component layout-->
            <button
                class="skill rel h-auto w-auto no-border overflow-hidden"
                [id]="'op-skill-' + (i + 1)"
                *ngFor="
                    let skill of currentOperator.skills;
                    let i = index;
                "
                [ngClass]="currentSkillIndex === i ? 'current no-pointer' : 'cur-pointer'"
                [class.visible]="currentFocus === i"
                (click)="setCurrentSkill(i)"
            >
                <ng-container *ngVar="currentOperatorSkills[i]!.levels[currentCombatSkillLevel.value] as currentSkillLevelInfo">
                    <div class="skill-cnt-title abs t0 r0 z0">SKILL_{{i + 1}}</div>
                    <div class="skill-header flex flex-row">
                        <img id="op-skill-img" class="transition-all" [src]="(currentOperatorSkills[i]?.iconId || currentOperatorSkills[i]?.skillId) ? ('/assets/gamedata/img/characters/skills/combat/skill_icon_' + (currentOperatorSkills[i]!.iconId ?? currentOperatorSkills[i]!.skillId) + '.png') : 'assets/img/ui/no_data_class.png'" alt="">
                        <div id="op-skill-overview" class="flex flex-col j-flex-space-between z1">
                            <div id="op-skill-name" class="grid">
                                <p class="no-margin main o0">{{currentSkillLevelInfo?.name ?? 'Unknown'}}</p>
                                <p class="no-margin italic o1"><i>{{currentSkillLevelInfo?.name ?? 'Unknown'}}</i></p>
                            </div>
                            <div
                                id="op-skill-characteristics"
                                style="gap: 10px"
                                class="flex flex-row flex-wrap transition-all"
                                *ngVar="currentSkillLevelInfo.spData.spType as skillType;"
                            >
                                <text-field
                                    [boundRect]="{ centerChildren: [true], height: '33px' }"
                                    [labelField]="{
                                        centerChildren: [true],
                                        height: '100%',
                                        width: '108px',
                                        borderMatrixOverride: ['', '0', '', ''],
                                        border: '1px solid black',
                                        background: '#c4c4c4'
                                    }"
                                    [labelFieldText]="{
                                        textValue: 'SP Charge',
                                        textSize: '18px',
                                        textAlign: 'center'
                                    }"
                                    [valueField]="{
                                        centerChildren: [true],
                                        height: '100%',
                                        width: (opUtils.resolveSpType(skillType).length + 6) + 'ch',
                                        borderFgMatchBg: true,
                                        border: '1px solid black',
                                        background: opUtils.resolveSpTypeColor(skillType).bg
                                    }"
                                    [valueFieldText]="{
                                        textValue: opUtils.resolveSpType(skillType),
                                        textSize: '18px',
                                        textAlign: 'center',
                                        textColor: opUtils.resolveSpTypeColor(skillType).text,
                                        fontWeight: '500'
                                    }"
                                ></text-field>
                                <text-field
                                    [boundRect]="{ centerChildren: [true], height: '33px' }"
                                    *ngVar="opUtils.resolveSkillType(currentSkillLevelInfo.skillType) as skilltypeString"
                                    [labelField]="{
                                        centerChildren: [true],
                                        height: '100%',
                                        width: '88px',
                                        borderMatrixOverride: ['', '0', '', ''],
                                        border: '1px solid black',
                                        background: '#c4c4c4'
                                    }"
                                    [labelFieldText]="{
                                        textValue: 'Trigger',
                                        textSize: '18px',
                                        textAlign: 'center'
                                    }"
                                    [valueField]="{
                                        centerChildren: [true],
                                        height: '100%',
                                        width: (skilltypeString.length + 5) + 'ch',
                                        borderFgMatchBg: true,
                                        border: '1px solid black',
                                        background: '#3F3F3F'
                                    }"
                                    [valueFieldText]="{
                                        textValue: skilltypeString,
                                        textSize: '18px',
                                        textAlign: 'center',
                                        textColor: '#FFFFFF'
                                    }"
                                ></text-field>
                                <text-field
                                    [boundRect]="{ centerChildren: [true], height: '33px' }"
                                    *ngVar="opUtils.resolveSkillDuration(currentSkillLevelInfo.duration) as currentSkillLevelDuration"
                                    [labelField]="{
                                        centerChildren: [true],
                                        height: '100%',
                                        width: '97px',
                                        borderMatrixOverride: ['', '0', '', ''],
                                        border: '1px solid black',
                                        background: '#c4c4c4'
                                    }"
                                    [labelFieldText]="{
                                        textValue: 'Duration',
                                        textSize: '18px',
                                        textAlign: 'center'
                                    }"
                                    [valueField]="{
                                        centerChildren: [true],
                                        height: '100%',
                                        width: (currentSkillLevelDuration.length + 6) + 'ch',
                                        borderFgMatchBg: true,
                                        border: '1px solid black',
                                        background: '#3F3F3F',
                                        extraCSS: { transition: 'width 0.4s ' + anime.timeFunc.Forceful }
                                    }"
                                    [valueFieldText]="{
                                        textValue: currentSkillLevelDuration,
                                        textSize: currentSkillLevelInfo.duration === -1 ? '37px' : '18px',
                                        textAlign: 'center',
                                        textColor: '#FFFFFF'
                                    }"
                                ></text-field>
                            </div>
                        </div>
                    </div>
                    <div class="skill-desc rel">
                        <!--? Weird behaviour: z-index doesn't work unless grid v-->
                        <div id="op-skill-desc" class="rel grid transition-all">
                            <div id="op-skill-currentlevel" class="abs grid b0 r0 z0 transition-all">
                                <div class="z0 transition-all" style="background-image: url(/assets/gamedata/img/characters/ui/skillrank/bg.png)"></div>
                                <div class="z0 transition-all" [style.background-image]="'url(/assets/gamedata/img/characters/ui/skillrank/' + (currentCombatSkillLevel.value < 7 ? add1(currentCombatSkillLevel.value) : ('m-' + (currentCombatSkillLevel.value - 6))) + '.png)'"></div>
                            </div>
                            <div id="content" class="z2 transition-all inline-blk" [innerHTML]="sanitizer.bypassSecurityTrustHtml(currentSkillDescriptions[i])"></div>
                        </div>
                    </div>
                    <div class="skill-params flex flex-col o0"
                        *ngIf="currentSkillLevelInfo?.blackboard?.length"
                    >
                        <button class="flex j-flex-space-between pointer-all cur-pointer" (click)="toggleSkillParams()">
                            <p style="padding-left: 10px; margin: 4px">Parameters</p>
                            <svg
                                class="a-self-center transition-all"
                                width="139" height="78" viewBox="0 0 139 78"
                                fill="none" xmlns="http://www.w3.org/2000/svg"
                                [style.transform]="skillParamsVisible ? 'rotate(180deg)' : 'rotate(0deg)'">
                            >
                                <rect x="0.109127" y="8.59441" width="12" height="97.9754" transform="rotate(-45 0.109127 8.59441)" fill="#000000"/>
                                <rect x="130.296" width="12" height="98" transform="rotate(45 130.296 0)" fill="#000000"/>
                            </svg>
                        </button>
                        <div
                            class="param-list transition-all flex flex-col fw overflow-hidden pointer-visible"
                            style = "background-color: hsl(0, 0%, 13%)"
                            [style.maxHeight]="skillParamsVisible ? (((currentSkillLevelInfo?.blackboard?.length ?? 0) * 37.5 + 35) + 'px') : '0'"
                        >
<!--                            (mouseleave)="onSkillParamHover(false)"-->
                            <div
                                class="param-item flex flex-row j-flex-space-between transition-all"
                                [ngClass]="{'cur-help hoverable pointer-visible': manager.getParamDesc(blackboardItem.key) }"
                                *ngFor="let blackboardItem of sortSkillBlackboard(currentOperatorSkills[i])"
                            >
<!--                            #param_item-->
<!--                            (mouseenter)="manager.getParamDesc(blackboardItem.key) ? onSkillParamHover(true, param_item, $event, manager.getParamDesc(blackboardItem.key)!) : null"-->
                                <div class="param-key flex flex-col">
                                    <p class="no-margin txt-algn-left">{{blackboardItem.key}}</p>
                                    <p class="param-desc no-margin transition-all overflow-hidden txt-algn-left" style="color:#fff" *ngIf="manager.getParamDesc(blackboardItem.key)">{{manager.getParamDesc(blackboardItem.key)}}</p>
                                </div>
                                <p
                                    class="no-margin param-var"
                                    *ngIf="manager.interpolateParamValue(blackboardItem.key, blackboardItem.value) as interpolatedParam"
                                    [ngClass]="{
                                        'negative': interpolatedParam[0] === false,
                                        'positive': interpolatedParam[0] === true
                                    }"
                                >{{interpolatedParam[1]}}</p>
                            </div>
                        </div>
                    </div>
                    <div class="skill-bottom-group o0 grid" [style.gap]="'12px'">
                        <div id="left-section" class="flex-grow-1">
                            <div
                                id="skill-range"
                                class="rel flex a-flex-center j-flex-center"
                                *ngVar="!!hasRangeData(i, currentCombatSkillLevel.value) as hasRangeData"
                                [style.background]="hasRangeData ? '' : 'linear-gradient(to top left, rgba(0,0,0,0) 0%, rgba(0,0,0,0) calc(50% - 2px), rgba(0,0,0,1) 50%, rgba(0,0,0,0) calc(50% + 2px), rgba(0,0,0,0) 100%)'"
                            >
                                <p placeholder class="abs t0 l0">Range</p>
                                <ng-container *ngIf="hasRangeData">
                                    <table
                                        id="skill-range-table"
                                        class="transition-all"
                                        [ngStyle]="{
                                            height: (currentSkillRanges[i]![1][0] * 36) + 'px',
                                            width: (currentSkillRanges[i]![1][1] * 36) + 'px'
                                        }"
                                    >
                                        <tr
                                            *ngFor="
                                                let row of currentSkillRanges[i]![0];
                                                let rowIndex = index;
                                                let rowLength = count
                                            "
                                            [ngStyle]="{
                                                width: (rowLength * 36) + 'px'
                                            }"
                                        >
                                            <td
                                                class="skill-range-cell pointer-all rel"
                                                *ngFor="
                                                    let cell of row;
                                                    let cellIndex = index;
                                                    let cellLength = count
                                                "
                                                [ngSwitch]="cell"
                                            >
                                                <div class="active" *ngSwitchCase="1"></div>
                                                <div class="extended" *ngSwitchCase="2"></div>
                                                <div class="character" *ngSwitchCase="3"></div>
                                                <div class="inactive" *ngSwitchCase="null"></div>
                                                <div class="arrow abs o0"></div>
                                                <div class="range-tile-desc abs w-auto flex flex-col o0 no-pointer">
                                                    <p class="tile-coord inline-flex"><i>ROW</i>&ThinSpace;{{rowIndex}}&nbsp;<i>COL</i>&ThinSpace;{{cellIndex}}</p>
                                                    <p *ngSwitchCase="1">{{currentOperator.name.split(' ')[0]}}&apos;s attack range.</p>
                                                    <p *ngSwitchCase="2">Extended range from skill.</p>
                                                    <p *ngSwitchCase="3">{{currentOperator.name.split(' ')[0]}} stands here.</p>
                                                    <p *ngSwitchCase="null">This tile has no effect.</p>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </ng-container>
                                <p NO_DATA *ngIf="!hasRangeData">NO_DATA</p>
                            </div>
                        </div>
                        <div id="right-section" class="flex flex-col fh">
                            <text-field
                                [boundRect]="{ centerChildren: [true], height: '33px' }"
                                [labelField]="{
                                        centerChildren: [true],
                                        height: '100%',
                                        width: '122px',
                                        borderMatrixOverride: ['', '0', '', ''],
                                        border: '1px solid black',
                                        background: '#c4c4c4'
                                    }"
                                [labelFieldText]="{
                                        textValue: 'Initial SP',
                                        textSize: '18px',
                                        textAlign: 'center'
                                    }"
                                [valueField]="{
                                        centerChildren: [true],
                                        height: '100%',
                                        width: (currentSkillLevelInfo.spData.initSp.toString().length + 2) + 'ch',
                                        borderFgMatchBg: true,
                                        border: '1px solid black',
                                        background: '#3F3F3F'
                                    }"
                                [valueFieldText]="{
                                        textValue: currentSkillLevelInfo.spData.initSp,
                                        textSize: '18px',
                                        textAlign: 'center',
                                        textColor: '#FFFFFF'
                                    }"
                            ></text-field>
                            <text-field
                                class="a.self-flstart"
                                [boundRect]="{ centerChildren: [true], height: '33px' }"
                                [labelField]="{
                                        centerChildren: [true],
                                        height: '100%',
                                        width: '102px',
                                        borderMatrixOverride: ['', '0', '', ''],
                                        border: '1px solid black',
                                        background: '#c4c4c4'
                                    }"
                                [labelFieldText]="{
                                        textValue: 'SP Cost',
                                        textSize: '18px',
                                        textAlign: 'center'
                                    }"
                                [valueField]="{
                                        centerChildren: [true],
                                        height: '100%',
                                        width: (currentSkillLevelInfo.spData.spCost.toString().length + 2) + 'ch',
                                        borderFgMatchBg: true,
                                        border: '1px solid black',
                                        background: '#3F3F3F',
                                        extraCSS: { transition: 'width 0.4s ' + anime.timeFunc.Forceful }
                                    }"
                                [valueFieldText]="{
                                        textValue: currentSkillLevelInfo.spData.spCost,
                                        textSize: '18px',
                                        textAlign: 'center',
                                        textColor: '#FFFFFF'
                                    }"
                            ></text-field>
                            <div id="skill-mat" class="rel flex flex-col" *ngVar="(currentCombatSkillLevel.value > 6 ? currentOperator.skills[i]!.levelUpCostCond[currentCombatSkillLevel.value - 7] : currentOperator.allSkillLvlup[currentCombatSkillLevel.value - 1]) as skillUpgradeReq">
                                <div placeholder class="flex j-flex-space-between">
                                    <p>Requirements</p>
                                    <div id="skill-req-lvl" class="flex a-flex-center" *ngIf="skillUpgradeReq">
                                        <img [src]="'/assets/gamedata/img/characters/ui/elite/' + skillUpgradeReq.unlockCond.phase + '_s_box.png'" alt="">&nbsp;
                                        <p>L{{skillUpgradeReq.unlockCond.level}}</p>
                                    </div>
                                </div>
                                <p *ngIf="!skillUpgradeReq">NO_DATA</p>
                                <div class="skill-mat-list flex pointer-all" *ngIf="skillUpgradeReq">
                                    <div
                                        *ngFor="let mat of (currentCombatSkillLevel.value > 6 ? skillUpgradeReq.levelUpCost! : skillUpgradeReq.lvlUpCost!)"
                                        class="skill-mat-item rel grid pointer-all"
                                    >
                                        <div class="skill-mat-rarity fh fw flex j-flex-center a-flex-center rel z0" [style.background-image]="'url(' + manager.getMatImg(mat.id)[1] + ')'" >
                                            <div class="skill-mat-img" [style.background-image]="'url(' + manager.getMatImg(mat.id)[0] + ')'"></div>
                                        </div>
                                        <p class="skill-mat-amount no-margin z1">{{mat.count}}</p>
<!--                                        <div class="skill-mat-desc abs bfull z2">-->
<!--                                            <p>{{mat.id}}&MediumSpace;<i></i></p>-->
<!--                                        </div>-->
                                    </div>
                                    <div *ngIf="skillUpgradeReq.levelUpTime">
                                        <svg style="height: 70px;" width="300" height="300" viewBox="0 0 300 300" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <circle cx="150" cy="150" r="147.5" stroke="black" stroke-width="5"/>
                                            <path d="M156 45C156 41.6863 153.314 39 150 39C146.686 39 144 41.6863 144 45L156 45ZM144 150L144 156L156 156L156 150L144 150ZM144 45L144 150L156 150L156 45L144 45Z" fill="black"/>
                                            <path d="M232 156C235.314 156 238 153.314 238 150C238 146.686 235.314 144 232 144V156ZM150 144H144V156H150V144ZM232 144H150V156H232V144Z" fill="black"/>
                                        </svg>
                                        {{skillUpgradeReq.levelUpTime}}hr
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </button>
        </div>
    </div>
    <div id="infra-skills" class="fw rel odd z1">

    </div>
</div>
